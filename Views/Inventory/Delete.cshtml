@model SparePart
@{
    ViewData["Title"] = "刪除備品";
}

<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header bg-danger">
                <h3 class="card-title text-white">
                    <i class="fas fa-exclamation-triangle"></i>
                    確認刪除
                </h3>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>警告！</strong> 您即將刪除以下備品，此操作無法復原。
                </div>

                <h5>備品資訊：</h5>
                <dl class="row">
                    <dt class="col-sm-3">編號:</dt>
                    <dd class="col-sm-9">@Model.No</dd>

                    <dt class="col-sm-3">廠區代碼:</dt>
                    <dd class="col-sm-9">@Model.PlantId</dd>

                    <dt class="col-sm-3">位置:</dt>
                    <dd class="col-sm-9">@Model.PositionId - @Model.SubPositionId</dd>

                    <dt class="col-sm-3">分類:</dt>
                    <dd class="col-sm-9">@Model.Category</dd>

                    <dt class="col-sm-3">描述:</dt>
                    <dd class="col-sm-9">@Model.Description</dd>

                    <dt class="col-sm-3">規格:</dt>
                    <dd class="col-sm-9">@Model.Specification</dd>

                    <dt class="col-sm-3">當前庫存:</dt>
                    <dd class="col-sm-9">
                        <span class="badge badge-lg @(Model.Quantity == 0 ? "badge-secondary" : "badge-warning")">
                            @Model.Quantity
                        </span>
                    </dd>

                    <dt class="col-sm-3">最後更新:</dt>
                    <dd class="col-sm-9">@Model.LastUpdated.ToString("yyyy-MM-dd HH:mm")</dd>

                    @if (!string.IsNullOrEmpty(Model.Remarks))
                    {
                        <dt class="col-sm-3">備註:</dt>
                        <dd class="col-sm-9">@Model.Remarks</dd>
                    }
                </dl>

                @if (Model.Quantity > 0)
                {
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-circle"></i>
                        <strong>注意！</strong> 此備品仍有 <strong>@Model.Quantity</strong> 個庫存，刪除後這些庫存將會清零。
                    </div>
                }
            </div>
            <div class="card-footer">
                <form asp-action="Delete" method="post" class="d-inline">
                    <input asp-for="No" type="hidden" />
                    <button type="submit" class="btn btn-danger" onclick="return confirmDelete()">
                        <i class="fas fa-trash"></i> 確認刪除
                    </button>
                </form>

                <a asp-action="Details" asp-route-id="@Model.No" class="btn btn-info">
                    <i class="fas fa-eye"></i> 查看詳情
                </a>

                <a asp-action="Index" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> 返回列表
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function confirmDelete() {
            var quantity = @Model.Quantity;
            var message = '您確定要刪除這個備品嗎？';

            if (quantity > 0) {
                message += `\n\n警告：此備品還有 ${quantity} 個庫存，刪除後將會清零！`;
            }

            message += '\n\n此操作無法復原！';

            return confirm(message);
        }

        $(document).ready(function() {
            // 自動聚焦到取消按鈕（安全做法）
            $('a[href*="Index"]').focus();

            // 防止意外按下 Enter 鍵
            $(document).on('keypress', function(e) {
                if (e.which === 13) { // Enter key
                    e.preventDefault();
                    return false;
                }
            });
        });
    </script>
}